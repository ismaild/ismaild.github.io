
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Setup a Docker container with MongoDB - C{}DIEZ</title>
  <meta name="author" content="Ismail Dhorat">

  
  <meta name="description" content="Setup MongoDB in a docker container">
  <meta name="keywords" content="docker, mongodb, saas">

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://blog.codiez.co.za/2013/09/setup-a-docker-container-with-mongodb">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="C{}DIEZ" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Oswald' rel='stylesheet' type='text/css'>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-4025799-12']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">C{}DIEZ</a></h1>
  
    <h2>second-person plural present subjunctive of coder</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:blog.codiez.co.za" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/archives">Archives</a></li>
  <li><a href="http://www.codiez.co.za">Home</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Setup a Docker Container With MongoDB</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-09-04T09:09:00+02:00" pubdate data-updated="true">Sep 4<span>th</span>, 2013</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>If you have not yet setup docker, follow the <a href="/2013/09/hello-docker/">install docker</a> post before this.</p>

<p>First, lets take a look at what docker images we have.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>dock@saas:~<span class="nv">$ </span>sudo docker images
</span><span class='line'>REPOSITORY          TAG                 ID                  CREATED             SIZE
</span><span class='line'>ubuntu              12.04               8dbd9e392a96        4 months ago        131.5 MB <span class="o">(</span>virtual 131.5 MB<span class="o">)</span>
</span><span class='line'>ubuntu              12.10               b750fe79269d        5 months ago        24.65 kB <span class="o">(</span>virtual 180.1 MB<span class="o">)</span>
</span><span class='line'>ubuntu              latest              8dbd9e392a96        4 months ago        131.5 MB <span class="o">(</span>virtual 131.5 MB<span class="o">)</span>
</span><span class='line'>ubuntu              precise             8dbd9e392a96        4 months ago        131.5 MB <span class="o">(</span>virtual 131.5 MB<span class="o">)</span>
</span><span class='line'>ubuntu              quantal             b750fe79269d        5 months ago        24.65 kB <span class="o">(</span>virtual 180.1 MB<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Notice we have the images locally, so if we run the hello world the command runs instantly, without the need to download images again.</p>

<p>Now, lets check if we have and docker containers running:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>dock@saas:~<span class="nv">$ </span>sudo docker ps
</span><span class='line'>ID                  IMAGE               COMMAND             CREATED             STATUS              PORTS
</span></code></pre></td></tr></table></div></figure>


<p>As expected, we do not have any containers currently running.</p>

<h2>Install MongoDB</h2>

<p>Start an interactive shell in a container with: <code>sudo docker run -i -t ubuntu /bin/bash</code></p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@f9d75a04ce10:/# apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 7F0CEB10
</span><span class='line'>
</span><span class='line'>root@f9d75a04ce10:/# <span class="nb">echo</span> <span class="s1">&#39;deb http://downloads-distro.mongodb.org/repo/ubuntu-upstart dist 10gen&#39;</span> | tee /etc/apt/sources.list.d/10gen.list
</span><span class='line'>
</span><span class='line'>root@f9d75a04ce10:/# apt-get update
</span><span class='line'>
</span><span class='line'><span class="c"># initctl fix</span>
</span><span class='line'>root@a1f0680f8458:/# dpkg-divert --local --rename --add /sbin/initctl
</span><span class='line'>
</span><span class='line'>root@a1f0680f8458:/# ln -s /bin/true /sbin/initctl
</span><span class='line'>
</span><span class='line'>root@a1f0680f8458:/# apt-get install mongodb-10gen
</span><span class='line'>
</span><span class='line'>root@a1f0680f8458:/# mkdir -p /data/db
</span><span class='line'>
</span><span class='line'>root@a1f0680f8458:/# mongod
</span><span class='line'>mongod --help <span class="k">for </span><span class="nb">help </span>and startup options
</span><span class='line'>Tue Sep  3 14:10:36.469 <span class="o">[</span>initandlisten<span class="o">]</span> MongoDB starting : <span class="nv">pid</span><span class="o">=</span>125 <span class="nv">port</span><span class="o">=</span>27017 <span class="nv">dbpath</span><span class="o">=</span>/data/db/ 64-bit <span class="nv">host</span><span class="o">=</span>a1f0680f8458
</span><span class='line'>
</span><span class='line'><span class="nb">exit</span>
</span></code></pre></td></tr></table></div></figure>


<p>MongoDB starts succesfully in the container. Now we need to commit the container, to save the state and push to the docker index.</p>

<p><code>sudo docker commit a1f0680f8458 codiez/mongodb</code></p>

<p>Remember to replace your container id, mine was <code>a1f0680f8458</code> which you can see at the prompt, and your <code>&lt;username&gt;/&lt;container_name&gt;</code></p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>dock@saas:~<span class="nv">$ </span>sudo docker commit a1f0680f8458 codiez/mongodb
</span><span class='line'>
</span><span class='line'>dock@saas:~<span class="nv">$ </span>sudo docker login
</span><span class='line'>Username: codiez
</span><span class='line'>Password:
</span><span class='line'>Email: ismail@codiez.co.za
</span><span class='line'>Login Succeeded
</span><span class='line'>dock@saas:~<span class="nv">$ </span>sudo docker push codiez/mongodb
</span><span class='line'>The push refers to a repository <span class="o">[</span>codiez/mongodb<span class="o">]</span> <span class="o">(</span>len: 1<span class="o">)</span>
</span><span class='line'>Processing checksums
</span><span class='line'>Sending image list
</span><span class='line'>Pushing repository codiez/mongodb <span class="o">(</span>1 tags<span class="o">)</span>
</span><span class='line'>Pushing 8dbd9e392a964056420e5d58ca5cc376ef18e2de93b5cc90e868a1bbc8318c1c
</span><span class='line'>Image 8dbd9e392a964056420e5d58ca5cc376ef18e2de93b5cc90e868a1bbc8318c1c already pushed, skipping
</span><span class='line'>Pushing tags <span class="k">for </span>rev <span class="o">[</span>8dbd9e392a964056420e5d58ca5cc376ef18e2de93b5cc90e868a1bbc8318c1c<span class="o">]</span> on <span class="o">{</span>https://registry-1.docker.io/v1/repositories/codiez/mongodb/tags/latest<span class="o">}</span>
</span><span class='line'>Pushing f0ab8043e4e8135379d35410a4847769efb9245d8d4817cb24a2196c434c8506
</span></code></pre></td></tr></table></div></figure>


<p>Once that completes, we can start MongoDB in the container, and map it to a port by running:</p>

<p><code>sudo docker run -d -p 27017 codiez/mongodb /usr/bin/mongod --smallfiles</code></p>

<p>This basically runs the container, based on the <code>codiez/mongodb</code> image, with the command <code>/usr/bin/mongod</code> and maps the default mongodb port 27017 to an external port.</p>

<p>Check that the container is running and get the port:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>dock@saas:~<span class="nv">$ </span>sudo docker ps
</span><span class='line'>ID                  IMAGE                   COMMAND             CREATED             STATUS              PORTS
</span><span class='line'>a02d24fed142        codiez/mongodb:latest   /usr/bin/mongod     5 seconds ago       Up 4 seconds        49157-&gt;27017
</span></code></pre></td></tr></table></div></figure>


<p>You can also inspect the image to grab the port by running <code>sudo docker inspect container_id</code></p>

<p>Now, we can test an external connection to MongoDB, test from your local machine and connect to the VM IP with the port for your container:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>mongo 192.168.0.21:49157
</span><span class='line'>MongoDB shell version: 2.4.5
</span><span class='line'>connecting to: 192.168.0.21:49157/test
</span><span class='line'>&gt; db
</span><span class='line'><span class="nb">test</span>
</span><span class='line'>&gt; db.posts.insert<span class="o">({</span>title:<span class="s2">&quot;Hello MongoDB in Docker&quot;</span><span class="o">})</span>
</span><span class='line'>&gt; db.posts.find<span class="o">()</span>
</span><span class='line'><span class="o">{</span> <span class="s2">&quot;_id&quot;</span> : ObjectId<span class="o">(</span><span class="s2">&quot;5227058d112c68baaa3b94d9&quot;</span><span class="o">)</span>, <span class="s2">&quot;title&quot;</span> : <span class="s2">&quot;Hello MongoDB in Docker&quot;</span> <span class="o">}</span>
</span><span class='line'>&gt;
</span></code></pre></td></tr></table></div></figure>


<p>One final commit to save the command and port mapping. Also notice you do not have to enter in the entire container id when running commands, just the first few characters.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>dock@saas:~<span class="nv">$ </span>sudo docker ps
</span><span class='line'>ID                  IMAGE                   COMMAND                CREATED             STATUS              PORTS
</span><span class='line'>298a43e2f98e        codiez/mongodb:latest   /usr/bin/mongod --sm   35 seconds ago      Up 34 seconds       49164-&gt;27017
</span><span class='line'>dock@saas:~<span class="nv">$ </span>sudo docker commit -run <span class="s1">&#39;{&quot;Cmd&quot;: [&quot;/usr/bin/mongod&quot;, &quot;--smallfiles&quot;], &quot;PortSpecs&quot;: [&quot;:27017&quot;]}&#39;</span> 298a4 codiez/mongodb
</span></code></pre></td></tr></table></div></figure>


<p>Now that we have an image, we can run <code>docker pull codiez/mongodb</code> to grab the container and run it with <code>docker run -d codiez/mongodb</code></p>

<p>The next post will discuss automating the creation of a container with a dockerfile.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Ismail Dhorat</span></span>

      








  


<time datetime="2013-09-04T09:09:00+02:00" pubdate data-updated="true">Sep 4<span>th</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/categories/docker/'>docker</a>, <a class='category' href='/categories/mongodb/'>mongodb</a>, <a class='category' href='/categories/saas/'>saas</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://blog.codiez.co.za/2013/09/setup-a-docker-container-with-mongodb/" data-via="ismail" data-counturl="http://blog.codiez.co.za/2013/09/setup-a-docker-container-with-mongodb/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2013/09/hello-docker/" title="Previous Post: Hello docker">&laquo; Hello docker</a>
      
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2013/09/setup-a-docker-container-with-mongodb/">Setup a Docker Container With MongoDB</a>
      </li>
    
      <li class="post">
        <a href="/2013/09/hello-docker/">Hello Docker</a>
      </li>
    
      <li class="post">
        <a href="/2013/08/uninstall-mysql-macports-install-homebrew-mac-osx/">Uninstall MySQL & MacPorts, Reinstall MySQL With Homebrew on Mac OSX</a>
      </li>
    
      <li class="post">
        <a href="/2013/07/editing-mongodb-arrays-in-rails/">Editing MongoDB Arrays in Rails</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Coderwall</h1>
  <ul id="cw_badges">
    <li class="loading">Status updating...</li>
  </ul>

  <script type="text/javascript">
    var coderwall = (function(){
      function render(options, badges){
        var fragment = '',
            t = $(options.target),
            height = 65,
            width = 65,
            index;

        for (index in badges) {
          fragment += '<a class="cw_badge"title="' + badges[index].description + '" href="http://coderwall.com/' + options.user + '">';
          fragment +=   '<img alt="' + badges[index].description + '" height="' + width + '" width="' + height + '" src="' + badges[index].badge + '"/>';
          fragment += '</a>';
        }

        t.html(fragment);
      }
      return {
        showBadges: function(options){
          $.ajax({
              url: 'http://coderwall.com/' + options.user + '.json?callback=?'
            , dataType: 'jsonp'
            , error: function (err) { $(options.target + ' li.loading').addClass('error').text("Error loading feed"); }
            , success: function(res) {
                render(options, res.data.badges);
            }
          });
        }
      };
    })();

    $(document).ready(function(){
      coderwall.showBadges({
        user: 'ismail',
        target: '#cw_badges'
      });
    });
  </script>
  <style type="text/css">
    .cw_badge img {
      padding: 5px;
      border: 0 none !important;
      -moz-box-shadow: none !important;
      -webkit-box-shadow: none !important;
      -o-box-shadow: none !important;
      box-shadow: none !important;
    }
  </style>
</section>


<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/ismaild">@ismaild</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'ismaild',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Ismail Dhorat -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'codiez';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://blog.codiez.co.za/2013/09/setup-a-docker-container-with-mongodb/';
        var disqus_url = 'http://blog.codiez.co.za/2013/09/setup-a-docker-container-with-mongodb/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
